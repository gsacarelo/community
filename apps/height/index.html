<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üìê 7-Min Height Routine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <style>
    :root {
      --bg1: #050816;
      --bg2: #10152f;
      --accent: #4f9dff;
      --accent-soft: rgba(79, 157, 255, 0.22);
      --accent-strong: #5be7c4;
      --danger: #ff6b81;
      --text-main: #f7f7ff;
      --text-muted: #a1aacd;
      --card-bg: rgba(8, 11, 30, 0.96);
      --border-soft: rgba(255, 255, 255, 0.08);
      --shadow-strong: 0 20px 45px rgba(0, 0, 0, 0.85);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      height: 100%;
      width: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: var(--text-main);
      height: 100vh;
      width: 100vw;
      overflow: hidden; /* prevent scroll + blank areas */
      display: flex;
      justify-content: center;
      align-items: center;
      background:
        radial-gradient(circle at 0% 0%, #1d2659, #050816 60%, #000000);
      position: relative;
    }

    body::before,
    body::after {
      content: "";
      position: absolute;
      border-radius: 999px;
      filter: blur(8px);
      pointer-events: none;
      opacity: 0.7;
      mix-blend-mode: screen;
    }

    body::before {
      width: 900px;
      height: 900px;
      background: radial-gradient(circle, rgba(79, 157, 255, 0.18), transparent 65%);
      top: -260px;
      right: -220px;
      animation: bgGlow1 20s infinite alternate ease-in-out;
    }

    body::after {
      width: 700px;
      height: 700px;
      background: radial-gradient(circle, rgba(91, 231, 196, 0.18), transparent 65%);
      bottom: -240px;
      left: -220px;
      animation: bgGlow2 24s infinite alternate ease-in-out;
    }

    @keyframes bgGlow1 {
      0% { transform: translate(0, 0) scale(1); opacity: 0.7; }
      50% { transform: translate(-40px, 40px) scale(1.07); opacity: 1; }
      100% { transform: translate(20px, -30px) scale(1.02); opacity: 0.6; }
    }

    @keyframes bgGlow2 {
      0% { transform: translate(0, 0) scale(1); opacity: 0.6; }
      50% { transform: translate(40px, -20px) scale(1.08); opacity: 1; }
      100% { transform: translate(-30px, 30px) scale(1.03); opacity: 0.6; }
    }

    .app-shell {
      position: relative;
      width: 100%;
      max-width: 420px;
      height: 100%;
      max-height: 780px;
      padding: 14px;
      z-index: 1;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .app-card {
      width: 100%;
      background: var(--card-bg);
      border-radius: 24px;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-strong);
      padding: 14px 16px 16px;
      backdrop-filter: blur(18px);
      display: flex;
      flex-direction: column;
      gap: 10px;
      animation: cardFloat 6s ease-in-out infinite;
    }

    @keyframes cardFloat {
      0% { transform: translateY(0px) scale(1); }
      50% { transform: translateY(-5px) scale(1.005); }
      100% { transform: translateY(0px) scale(1); }
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .app-title-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .app-title-dot {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: radial-gradient(circle, var(--accent-strong), var(--accent));
      box-shadow: 0 0 18px rgba(91, 231, 196, 0.9);
      animation: titleDotPulse 2s infinite ease-out;
    }

    @keyframes titleDotPulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.5); opacity: 0.55; }
      100% { transform: scale(1); opacity: 1; }
    }

    .app-title-text {
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .app-subtitle {
      font-size: 0.76rem;
      color: var(--text-muted);
      opacity: 0.95;
    }

    .header-actions {
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }

    .icon-btn {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: radial-gradient(circle at 30% 0%, rgba(79, 157, 255, 0.35), rgba(7, 11, 31, 0.96));
      color: var(--text-main);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease, border 0.18s ease, background 0.18s ease;
    }

    .icon-btn:hover {
      transform: translateY(-1px) scale(1.05);
      box-shadow: 0 0 18px rgba(79, 157, 255, 0.7);
      border-color: var(--accent-soft);
    }

    .icon-btn:active {
      transform: translateY(0) scale(0.98);
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
    }

    .meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .meta-chips {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .meta-chip {
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(5, 9, 26, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .meta-chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent-strong);
      box-shadow: 0 0 10px rgba(91, 231, 196, 0.9);
    }

    .meta-time {
      text-align: right;
    }

    .step-indicators {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-top: 4px;
      margin-bottom: 4px;
    }

    .step-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(10, 14, 36, 0.9);
      box-shadow: 0 0 0 rgba(79, 157, 255, 0.0);
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, border 0.2s ease;
    }

    .step-dot.active {
      background: var(--accent);
      box-shadow: 0 0 10px rgba(79, 157, 255, 0.8);
      transform: scale(1.1);
    }

    .step-dot.current {
      background: var(--accent-strong);
      box-shadow: 0 0 15px rgba(91, 231, 196, 0.9);
      transform: scale(1.25);
    }

    /* Overall routine progress bar */
    .routine-progress-wrapper {
      margin-top: 4px;
      margin-bottom: 2px;
    }

    .routine-progress-label {
      font-size: 0.72rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2px;
    }

    .routine-progress-bar {
      width: 100%;
      height: 7px;
      border-radius: 999px;
      background: rgba(7, 11, 30, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }

    .routine-progress-inner {
      height: 100%;
      width: 0%;
      border-radius: inherit;
      background: linear-gradient(90deg, var(--accent), var(--accent-strong));
      box-shadow: 0 0 14px rgba(79, 157, 255, 0.8);
      transition: width 0.25s ease-out;
    }

    .main-section {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 2px;
    }

    .timer-area {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 4px;
      margin-bottom: 6px;
    }

    .timer-circle {
      width: 180px;
      height: 180px;
      max-width: 60vw;
      max-height: 60vw;
      border-radius: 50%;
      background: conic-gradient(var(--accent-strong) 0deg, rgba(6, 10, 25, 0.96) 0deg);
      border: 1px solid rgba(255, 255, 255, 0.14);
      box-shadow:
        0 0 24px rgba(79, 157, 255, 0.65),
        0 18px 40px rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      animation: timerFloat 4.2s ease-in-out infinite;
    }

    @keyframes timerFloat {
      0% { transform: translateY(0px) scale(1); }
      50% { transform: translateY(-3px) scale(1.03); }
      100% { transform: translateY(0px) scale(1); }
    }

    .timer-circle::before {
      content: "";
      position: absolute;
      inset: 10%;
      border-radius: inherit;
      background:
        radial-gradient(circle at 20% 0%, rgba(79, 157, 255, 0.35), transparent 60%),
        radial-gradient(circle at 80% 100%, rgba(91, 231, 196, 0.25), transparent 60%);
      opacity: 0.9;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .timer-inner {
      position: relative;
      z-index: 1;
      width: 72%;
      height: 72%;
      border-radius: 50%;
      background: radial-gradient(circle at 50% 0%, rgba(7, 11, 30, 0.98), #050816);
      border: 1px solid rgba(255, 255, 255, 0.08);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .timer-label {
      font-size: 0.7rem;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .timer-value {
      font-variant-numeric: tabular-nums;
      font-size: 1.9rem;
      font-weight: 600;
      letter-spacing: 0.08em;
    }

    .step-status-text {
      font-size: 0.75rem;
      color: var(--text-muted);
      opacity: 0.95;
    }

    .exercise-info {
      text-align: left;
    }

    .exercise-step-label {
      font-size: 0.76rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-muted);
      opacity: 0.95;
    }

    .exercise-name {
      margin-top: 2px;
      font-size: 1.05rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
    }

    .exercise-name-bar {
      width: 18px;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent-strong));
      box-shadow: 0 0 10px rgba(79, 157, 255, 0.9);
      animation: nameBarPulse 2.8s infinite ease-in-out;
    }

    @keyframes nameBarPulse {
      0% { transform: scaleX(1); opacity: 0.6; }
      50% { transform: scaleX(1.5); opacity: 1; }
      100% { transform: scaleX(1); opacity: 0.6; }
    }

    .exercise-title-text {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .exercise-toggle-icon {
      font-size: 0.9rem;
      opacity: 0.9;
      transition: transform 0.2s ease;
    }

    .exercise-description {
      margin-top: 4px;
      font-size: 0.84rem;
      color: var(--text-muted);
      line-height: 1.45;
      display: none;
    }

    .exercise-description.visible {
      display: block;
    }

    .exercise-name.expanded .exercise-toggle-icon {
      transform: rotate(90deg);
    }

    .controls-area {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .primary-btn {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 11px 12px;
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      background: radial-gradient(circle at 0% 0%, rgba(255, 255, 255, 0.22), transparent 50%),
                  linear-gradient(135deg, rgba(79, 157, 255, 0.98), rgba(91, 231, 196, 0.98));
      color: #02040a;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow:
        0 12px 26px rgba(79, 157, 255, 0.65),
        0 0 20px rgba(91, 231, 196, 0.8);
      transition: transform 0.16s ease, box-shadow 0.16s ease, filter 0.16s ease;
    }

    .primary-btn span.icon {
      font-size: 1.1rem;
    }

    .primary-btn:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow:
        0 18px 32px rgba(79, 157, 255, 0.9),
        0 0 30px rgba(91, 231, 196, 1);
      filter: brightness(1.05);
    }

    .primary-btn:active {
      transform: translateY(0) scale(0.98);
      box-shadow:
        0 6px 16px rgba(0, 0, 0, 0.9);
      filter: brightness(0.97);
    }

    .primary-btn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
      filter: none;
    }

    .secondary-controls-row {
      display: flex;
      gap: 6px;
    }

    .sec-btn {
      flex: 1;
      min-width: 0;
      border-radius: 999px;
      padding: 7px 8px;
      font-size: 0.8rem;
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: rgba(6, 10, 28, 0.96);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.14s ease, box-shadow 0.14s ease, border 0.14s ease, background 0.14s ease, color 0.14s ease;
    }

    .sec-btn span.icon {
      font-size: 1rem;
    }

    .sec-btn:hover:not(:disabled) {
      transform: translateY(-1px) scale(1.02);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.7);
      border-color: var(--accent-soft);
      color: var(--text-main);
    }

    .sec-btn:active:not(:disabled) {
      transform: translateY(0) scale(0.97);
      box-shadow: none;
    }

    .sec-btn-danger {
      border-color: rgba(255, 107, 129, 0.7);
      color: var(--danger);
      background: rgba(32, 7, 12, 0.92);
    }

    .sec-btn:disabled {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
    }

    .footer-hint {
      margin-top: 2px;
      font-size: 0.74rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
      opacity: 0.9;
    }

    .footer-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(79, 157, 255, 0.9);
      animation: hintPulse 2.4s infinite ease-out;
    }

    @keyframes hintPulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.5); opacity: 0.4; }
      100% { transform: scale(1); opacity: 1; }
    }

    .step-animate {
      animation: stepFlash 0.5s ease-out;
    }

    @keyframes stepFlash {
      0% {
        box-shadow: 0 0 0 rgba(91, 231, 196, 0.0);
        transform: translateY(0) scale(1);
      }
      30% {
        box-shadow: 0 0 24px rgba(91, 231, 196, 0.95);
        transform: translateY(-2px) scale(1.02);
      }
      100% {
        box-shadow: 0 0 0 rgba(91, 231, 196, 0.0);
        transform: translateY(0) scale(1);
      }
    }

    /* ABOUT OVERLAY ‚Äì now inside app-shell */
    .about-overlay {
      position: absolute;
      inset: 0;
      background: rgba(3, 6, 18, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 20;
      border-radius: 24px; /* matches card */
    }

    .about-overlay.visible {
      display: flex;
      animation: overlayIn 0.22s ease-out;
    }

    @keyframes overlayIn {
      from { opacity: 0; transform: scale(1.03); }
      to   { opacity: 1; transform: scale(1); }
    }

    .about-card {
      max-width: 420px;
      width: 100%;
      background: radial-gradient(circle at 0% 0%, rgba(79, 157, 255, 0.2), #050816);
      border-radius: 22px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      padding: 16px 16px 14px;
      box-shadow: var(--shadow-strong);
      position: relative;
      overflow: hidden;
    }

    .about-card::before {
      content: "";
      position: absolute;
      inset: -35%;
      background:
        radial-gradient(circle at 10% 0%, rgba(91, 231, 196, 0.18), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(79, 157, 255, 0.16), transparent 60%);
      opacity: 0.7;
      mix-blend-mode: screen;
    }

    .about-inner {
      position: relative;
      z-index: 1;
    }

    .about-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .about-title {
      font-size: 0.98rem;
      font-weight: 600;
    }

    .about-tag {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      color: var(--text-muted);
    }

    .about-close-btn {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.26);
      background: rgba(7, 11, 32, 0.98);
      color: var(--text-main);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1rem;
      transition: transform 0.14s ease, box-shadow 0.14s ease, background 0.14s ease;
    }

    .about-close-btn:hover {
      transform: translateY(-1px) scale(1.03);
      box-shadow: 0 0 16px rgba(79, 157, 255, 0.7);
      background: rgba(5, 9, 26, 1);
    }

    .about-section {
      margin-top: 6px;
      margin-bottom: 4px;
      font-size: 0.84rem;
      color: var(--text-muted);
      line-height: 1.45;
    }

    .about-section strong {
      color: var(--text-main);
    }

    .sequence-list {
      margin-top: 4px;
      padding-left: 18px;
      font-size: 0.82rem;
    }

    .sequence-list li {
      margin-bottom: 2px;
    }

    .contact-list {
      list-style: none;
      margin-top: 6px;
    }

    .contact-list li {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
      font-size: 0.82rem;
    }

    .contact-tag {
      font-size: 0.72rem;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(8, 13, 32, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.12);
      color: var(--accent-strong);
    }

    .contact-list a {
      color: var(--accent-strong);
      text-decoration: none;
    }

    .contact-list a:hover {
      text-decoration: underline;
    }

    .mini-note {
      margin-top: 6px;
      font-size: 0.72rem;
      color: var(--text-muted);
      opacity: 0.8;
    }

    @media (max-width: 480px) {
      .app-card {
        padding: 12px 12px 14px;
        border-radius: 20px;
      }
      .app-title-text {
        font-size: 0.92rem;
      }
      .app-subtitle {
        font-size: 0.72rem;
      }
      .timer-circle {
        width: 160px;
        height: 160px;
      }
      .timer-value {
        font-size: 1.7rem;
      }
      .exercise-description {
        font-size: 0.82rem;
      }
      .primary-btn {
        padding: 10px;
        font-size: 0.9rem;
      }
      .sec-btn {
        padding: 6px 6px;
        font-size: 0.78rem;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- ABOUT OVERLAY (now inside app-shell, centered on app) -->
    <div class="about-overlay" id="aboutOverlay">
      <div class="about-card">
        <div class="about-inner">
          <div class="about-header-row">
            <div>
              <div class="about-title">7-Min Height Routine</div>
              <div class="about-tag">Info & Sequence</div>
            </div>
            <button class="about-close-btn" id="aboutCloseBtn" aria-label="Close about panel">&times;</button>
          </div>
          <div class="about-section">
            <strong>Purpose:</strong> short sequence focused on spinal decompression, posture and pelvic alignment.
          </div>
          <div class="about-section">
            <strong>Structure:</strong> 7 timed steps, bodyweight only, designed for daily use.
          </div>
          <div class="about-section">
            <strong>Sequence:</strong>
            <ol class="sequence-list">
              <li>Doorframe Decompression ‚Äì 60 s</li>
              <li>Cobra Stretch ‚Äì 45 s</li>
              <li>Hip Flexor Stretch (Left) ‚Äì 45 s</li>
              <li>Hip Flexor Stretch (Right) ‚Äì 45 s</li>
              <li>Thoracic Extension ‚Äì 60 s</li>
              <li>Cat‚ÄìCow Flow ‚Äì 60 s</li>
              <li>Glute Bridge Hold ‚Äì 60 s</li>
            </ol>
          </div>
          <div class="about-section">
            <strong>Contacts Information:</strong>
            <ul class="contact-list">
            <li>
              <span class="contact-tag">Author</span>
              <span>Gerardo Sacarelo V.</span>
            </li>
            <li>
              <a href="https://instagram.com/gerardo711" target="_blank">
                <span class="contact-tag">Instagram</span></a>
              <span>@gerardo711</span>
            </li>
            <li>
              <a href="https://t.me/GerardoSacarelo" target="_blank">
                 <span class="contact-tag">Telegram</span></a>
              <span>@GerardoSacarelo</span>
            </li>
          </ul>
            <div class="mini-note">
              "Excuses don‚Äôt exist anywhere besides your mind"
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MAIN APP -->
    <div class="app-card" id="routineCard">
      <header class="app-header">
        <div class="title-block">
          <div class="app-title-row">
            <div class="app-title-dot"></div>
            <div class="app-title-text">Height Routine</div>
          </div>
          <div class="app-subtitle">7-minute micro-session</div>
        </div>
        <div class="header-actions">
          <button class="icon-btn" id="mainPageBtn" title="Main page">üè†</button>
          <button class="icon-btn" id="soundBtn" title="Sound on/off">üîä</button>
          <button class="icon-btn" id="screenBtn" title="Screen on/off">üí°</button>
          <button class="icon-btn" id="aboutBtn" title="About & sequence">‚ÑπÔ∏è</button>
        </div>
      </header>

      <div class="meta-row">
        <div class="meta-chips">
          <div class="meta-chip">
            <span class="meta-chip-dot"></span>
            <span>Bodyweight ‚Ä¢ Low impact</span>
          </div>
        </div>
        <div class="meta-time">
          7 guided steps
        </div>
      </div>

      <div class="step-indicators" id="stepIndicators"></div>

      <!-- Overall routine progress -->
      <div class="routine-progress-wrapper">
        <div class="routine-progress-label">
          <span>Routine progress</span>
          <span id="routineProgressText">0%</span>
        </div>
        <div class="routine-progress-bar">
          <div class="routine-progress-inner" id="routineProgressInner"></div>
        </div>
      </div>

      <main class="main-section">
        <div class="timer-area">
          <div class="timer-circle" id="timerCircle">
            <div class="timer-inner">
              <div class="timer-label">Time left</div>
              <div class="timer-value" id="timeDisplay">01:00</div>
              <div class="step-status-text" id="stepStatus">Ready</div>
            </div>
          </div>
        </div>

        <section class="exercise-info">
          <div class="exercise-step-label" id="stepCounter">Step 1 of 7</div>
          <div class="exercise-name" id="exerciseNameContainer">
            <div class="exercise-name-bar"></div>
            <span class="exercise-title-text">
              <span id="exerciseName">Doorframe Decompression</span>
              <span class="exercise-toggle-icon" id="exerciseToggleIcon">‚Ä∫</span>
            </span>
          </div>
          <p class="exercise-description" id="exerciseDescription">
            Grab the top of a doorframe, let your heels barely touch the floor, and relax your spine while breathing calmly.
          </p>
        </section>

        <section class="controls-area">
          <button class="primary-btn" id="primaryBtn">
            <span class="icon" id="primaryIcon">‚ñ∂Ô∏è</span>
            <span id="primaryLabel">Start</span>
          </button>

          <div class="secondary-controls-row">
            <button class="sec-btn" id="prevBtn">
              <span class="icon">‚óÄÔ∏è</span>
              <span>Previous</span>
            </button>
            <button class="sec-btn" id="nextBtn">
              <span class="icon">‚ñ∂Ô∏è</span>
              <span id="nextLabel">Next</span>
            </button>
            <button class="sec-btn sec-btn-danger" id="resetBtn">
              <span class="icon">‚Ü∫</span>
              <span>Reset</span>
            </button>
          </div>

          <div class="footer-hint">
            <div class="footer-dot"></div>
            <span>Made with ‚ù§Ô∏è by Gerardo Sacarelo V.</span>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script>
    // --- ROUTINE DEFINITION ---
    const steps = [
      {
        name: "Doorframe Decompression",
        seconds: 60,
        description:
          "Grab the top of a doorframe, let your heels barely touch the floor, and relax your spine. Breathe slowly through your nose."
      },
      {
        name: "Cobra Stretch",
        seconds: 45,
        description:
          "Lay face down, hands under the shoulders. Push the chest up while keeping the hips on the floor. Keep the neck relaxed."
      },
      {
        name: "Hip Flexor Stretch (Left)",
        seconds: 45,
        description:
          "Left knee on the floor, right foot forward. Push the hips forward gently, stay tall, and keep the left glute lightly active."
      },
      {
        name: "Hip Flexor Stretch (Right)",
        seconds: 45,
        description:
          "Right knee on the floor, left foot forward. Push the hips forward gently while keeping the torso upright and steady."
      },
      {
        name: "Thoracic Extension",
        seconds: 60,
        description:
          "Lay on the back, hands behind the head. Gently arch the upper back off the floor while keeping the lower back relaxed."
      },
      {
        name: "Cat‚ÄìCow Flow",
        seconds: 60,
        description:
          "On all fours. Alternate between rounding the spine up and lowering the belly with the chest open, matching the movement with slow breathing."
      },
      {
        name: "Glute Bridge Hold",
        seconds: 60,
        description:
          "Lay on the back, feet flat. Lift the hips, squeeze the glutes, and keep the ribs in line with the pelvis while breathing steadily."
      }
    ];

    const totalRoutineSeconds = steps.reduce((sum, s) => sum + s.seconds, 0);

    let currentStepIndex = 0;
    let remainingSeconds = steps[0].seconds;
    let isRunning = false;
    let timerId = null;
    let stepElapsed = steps.map(() => 0); // seconds spent per step

    // Sound + TTS
    let soundEnabled = true;
    let audioCtx = null;
    let selectedVoice = null;

    // Screen Wake Lock
    let wakeLock = null;
    let wakeLockEnabled = true; // default ON

    function getAudioContext() {
      if (!audioCtx) {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (!AC) return null;
        audioCtx = new AC();
      }
      if (audioCtx && audioCtx.state === "suspended") {
        audioCtx.resume();
      }
      return audioCtx;
    }

    function playBeep(duration = 200, frequency = 880, volume = 0.35) {
      if (!soundEnabled) return;
      const ctx = getAudioContext();
      if (!ctx) return;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = "sine";
      osc.frequency.value = frequency;
      gain.gain.value = volume;
      osc.connect(gain);
      gain.connect(ctx.destination);
      const now = ctx.currentTime;
      osc.start(now);
      osc.stop(now + duration / 1000);
    }

    function chooseVoice() {
      if (!("speechSynthesis" in window)) return;
      const voices = window.speechSynthesis.getVoices();
      if (!voices || !voices.length) return;

      const preferredNames = [
        "Google US English",
        "Microsoft Zira",
        "Samantha",
        "Jenny",
        "Aria"
      ];

      let found =
        voices.find(v =>
          preferredNames.some(name => v.name.toLowerCase().includes(name.toLowerCase()))
        ) ||
        voices.find(v =>
          /female|woman|zira|samantha|linda|eva|susan|jenny|aria/i.test(v.name)
        ) ||
        voices.find(v => v.lang && v.lang.startsWith("en")) ||
        voices[0];

      selectedVoice = found || null;
    }

    if ("speechSynthesis" in window) {
      window.speechSynthesis.onvoiceschanged = chooseVoice;
      chooseVoice();
    }

    function speak(text, rate = 1.1) {
      if (!soundEnabled) return;
      if (!("speechSynthesis" in window)) return;
      try {
        const u = new SpeechSynthesisUtterance(text);
        if (selectedVoice) {
          u.voice = selectedVoice;
          u.lang = selectedVoice.lang || "en-US";
        } else {
          u.lang = "en-US";
        }
        u.rate = rate;
        u.pitch = 1.25; // more feminine
        window.speechSynthesis.speak(u);
      } catch (e) {
        // ignore
      }
    }

    function playStartCue() {
      playBeep(200, 1000, 0.4);
      speak(`Step ${currentStepIndex + 1}: ${steps[currentStepIndex].name}`, 1.0);
    }

    // Wake Lock logic
    async function requestWakeLock() {
      if (!wakeLockEnabled) return;
      if (!("wakeLock" in navigator)) return;

      try {
        wakeLock = await navigator.wakeLock.request("screen");
        wakeLock.addEventListener("release", () => {
          wakeLock = null;
          // Try to re-acquire if still enabled
          if (wakeLockEnabled && document.visibilityState === "visible") {
            requestWakeLock();
          }
        });
      } catch (err) {
        // likely unsupported or blocked; ignore silently
        wakeLock = null;
      }
    }

    async function releaseWakeLock() {
      if (wakeLock) {
        try {
          await wakeLock.release();
        } catch (e) {}
        wakeLock = null;
      }
    }

    document.addEventListener("visibilitychange", () => {
      if (document.visibilityState === "visible") {
        if (wakeLockEnabled) requestWakeLock();
      } else {
        releaseWakeLock();
      }
    });

    // --- DOM ELEMENTS ---
    const routineCardEl = document.getElementById("routineCard");
    const stepIndicatorsEl = document.getElementById("stepIndicators");

    const timeDisplayEl = document.getElementById("timeDisplay");
    const stepStatusEl = document.getElementById("stepStatus");
    const stepCounterEl = document.getElementById("stepCounter");
    const exerciseNameEl = document.getElementById("exerciseName");
    const exerciseDescriptionEl = document.getElementById("exerciseDescription");
    const exerciseNameContainer = document.getElementById("exerciseNameContainer");
    const exerciseToggleIcon = document.getElementById("exerciseToggleIcon");
    const timerCircleEl = document.getElementById("timerCircle");

    const primaryBtn = document.getElementById("primaryBtn");
    const primaryLabelEl = document.getElementById("primaryLabel");
    const primaryIconEl = document.getElementById("primaryIcon");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const nextLabelEl = document.getElementById("nextLabel");
    const resetBtn = document.getElementById("resetBtn");

    const routineProgressInner = document.getElementById("routineProgressInner");
    const routineProgressText = document.getElementById("routineProgressText");

    const aboutBtn = document.getElementById("aboutBtn");
    const aboutOverlay = document.getElementById("aboutOverlay");
    const aboutCloseBtn = document.getElementById("aboutCloseBtn");
    const mainPageBtn = document.getElementById("mainPageBtn");
    const soundBtn = document.getElementById("soundBtn");
    const screenBtn = document.getElementById("screenBtn");

    // Build step indicators
    const stepDots = [];
    steps.forEach((_, idx) => {
      const dot = document.createElement("span");
      dot.className = "step-dot";
      stepIndicatorsEl.appendChild(dot);
      stepDots.push(dot);
    });

    // --- HELPERS ---
    function formatTime(sec) {
      const minutes = Math.floor(sec / 60);
      const seconds = sec % 60;
      const mm = String(minutes).padStart(2, "0");
      const ss = String(seconds).padStart(2, "0");
      return `${mm}:${ss}`;
    }

    function currentStepElapsed() {
      return stepElapsed[currentStepIndex];
    }

    function totalElapsedSeconds() {
      return stepElapsed.reduce((s, v) => s + v, 0);
    }

    function getDisplayIndex() {
      // After a step finishes, show next step's name/description (if exists)
      if (remainingSeconds === 0 && currentStepIndex < steps.length - 1) {
        return currentStepIndex + 1;
      }
      return currentStepIndex;
    }

    function updateTimerCircle() {
      const step = steps[currentStepIndex];
      const elapsed = currentStepElapsed();
      const percent = step.seconds > 0 ? Math.min(100, Math.round((elapsed / step.seconds) * 100)) : 0;
      const angle = (percent / 100) * 360;
      timerCircleEl.style.background = `conic-gradient(var(--accent-strong) ${angle}deg, rgba(6, 10, 25, 0.96) ${angle}deg)`;
    }

    function updateRoutineProgress() {
      const elapsed = totalElapsedSeconds();
      const percent = totalRoutineSeconds > 0 ? Math.min(100, Math.round((elapsed / totalRoutineSeconds) * 100)) : 0;
      routineProgressInner.style.width = `${percent}%`;
      routineProgressText.textContent = `${percent}%`;
    }

    function updateStepDots() {
      const displayIndex = getDisplayIndex();
      stepDots.forEach((dot, idx) => {
        dot.classList.remove("active", "current");
        if (idx < displayIndex) {
          dot.classList.add("active");
        } else if (idx === displayIndex) {
          dot.classList.add("current");
        }
      });
    }

    function updateButtons() {
      const step = steps[currentStepIndex];

      if (remainingSeconds === 0) {
        primaryBtn.disabled = false;
        if (currentStepIndex < steps.length - 1) {
          primaryLabelEl.textContent = "Next";
          primaryIconEl.textContent = "‚è≠Ô∏è";
        } else {
          primaryLabelEl.textContent = "Done";
          primaryIconEl.textContent = "‚úÖ";
        }
      } else {
        if (!isRunning && remainingSeconds === step.seconds) {
          primaryBtn.disabled = false;
          primaryLabelEl.textContent = "Start";
          primaryIconEl.textContent = "‚ñ∂Ô∏è";
        } else if (isRunning) {
          primaryBtn.disabled = false;
          primaryLabelEl.textContent = "Pause";
          primaryIconEl.textContent = "‚è∏Ô∏è";
        } else if (!isRunning && remainingSeconds < step.seconds) {
          primaryBtn.disabled = false;
          primaryLabelEl.textContent = "Resume";
          primaryIconEl.textContent = "‚ñ∂Ô∏è";
        }
      }

      nextLabelEl.textContent = "Next";
      prevBtn.disabled = currentStepIndex === 0;
    }

    function updateStatusText() {
      const step = steps[currentStepIndex];
      if (remainingSeconds === step.seconds && !isRunning) {
        stepStatusEl.textContent = "Ready";
      } else if (isRunning) {
        stepStatusEl.textContent = "Running";
      } else if (remainingSeconds === 0) {
        stepStatusEl.textContent = "Completed";
      } else {
        stepStatusEl.textContent = "Paused";
      }
    }

    function updateUI() {
      const logicalStep = steps[currentStepIndex];
      const displayIndex = getDisplayIndex();
      const displayStep = steps[displayIndex];

      stepCounterEl.textContent = `Step ${displayIndex + 1} of ${steps.length}`;
      exerciseNameEl.textContent = displayStep.name;
      exerciseDescriptionEl.textContent = displayStep.description;

      timeDisplayEl.textContent = formatTime(remainingSeconds);
      updateTimerCircle();
      updateRoutineProgress();
      updateStepDots();
      updateButtons();
      updateStatusText();
    }

    function triggerStepAnimation() {
      routineCardEl.classList.remove("step-animate");
      void routineCardEl.offsetWidth;
      routineCardEl.classList.add("step-animate");
    }

    function stopTimer() {
      if (timerId) {
        clearInterval(timerId);
        timerId = null;
      }
      isRunning = false;
    }

    function startTimer() {
      if (isRunning || remainingSeconds === 0) return;
      isRunning = true;
      timerId = setInterval(() => {
        if (remainingSeconds > 0) {
          remainingSeconds--;
          const step = steps[currentStepIndex];

          if (stepElapsed[currentStepIndex] < step.seconds) {
            stepElapsed[currentStepIndex]++;
          }

          // Countdown 3, 2, 1 with beep + female voice
          if (remainingSeconds > 0 && remainingSeconds <= 3) {
            playBeep(120, 1200, 0.45);
            speak(String(remainingSeconds), 1.15);
          }

          updateUI();

          if (remainingSeconds === 0) {
            // ensure elapsed = full step
            stepElapsed[currentStepIndex] = step.seconds;
            playBeep(180, 900, 0.45); // final beep on step end
            stopTimer();
            updateUI();
          }
        } else {
          stopTimer();
          updateUI();
        }
      }, 1000);
    }

    function goToStep(index) {
      const bounded = Math.max(0, Math.min(steps.length - 1, index));
      currentStepIndex = bounded;
      const step = steps[bounded];
      remainingSeconds = Math.max(0, step.seconds - stepElapsed[bounded]);
      stopTimer();
      triggerStepAnimation();
      updateUI();
    }

    function resetRoutine() {
      currentStepIndex = 0;
      remainingSeconds = steps[0].seconds;
      stepElapsed = steps.map(() => 0);
      stopTimer();
      triggerStepAnimation();
      updateUI();
    }

    function updateSoundIcon() {
      soundBtn.textContent = soundEnabled ? "üîä" : "üîà";
    }

    function updateScreenIcon() {
      screenBtn.textContent = wakeLockEnabled ? "üí°" : "üí§";
    }

    // --- EVENT HANDLERS ---
    primaryBtn.addEventListener("click", () => {
      const step = steps[currentStepIndex];

      // ensure wake lock when user interacts
      if (wakeLockEnabled) requestWakeLock();

      // If step finished
      if (remainingSeconds === 0) {
        if (currentStepIndex < steps.length - 1) {
          currentStepIndex++;
          remainingSeconds = steps[currentStepIndex].seconds;
          triggerStepAnimation();
          stopTimer();
          updateUI();
        } else {
          resetRoutine();
        }
        return;
      }

      // Step not finished yet
      if (!isRunning && remainingSeconds === step.seconds) {
        playStartCue();
      }

      if (!isRunning) {
        startTimer();
      } else {
        stopTimer();
        updateUI();
      }
    });

    prevBtn.addEventListener("click", () => {
      if (currentStepIndex > 0) {
        goToStep(currentStepIndex - 1);
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentStepIndex < steps.length - 1) {
        goToStep(currentStepIndex + 1);
      } else {
        resetRoutine();
      }
    });

    resetBtn.addEventListener("click", () => {
      resetRoutine();
    });

    // Toggle description on exercise name click
    exerciseNameContainer.addEventListener("click", () => {
      const isVisible = exerciseDescriptionEl.classList.contains("visible");
      if (isVisible) {
        exerciseDescriptionEl.classList.remove("visible");
        exerciseNameContainer.classList.remove("expanded");
      } else {
        exerciseDescriptionEl.classList.add("visible");
        exerciseNameContainer.classList.add("expanded");
      }
    });

    // Keyboard shortcuts
    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        e.preventDefault();
        primaryBtn.click();
      } else if (e.code === "ArrowLeft") {
        prevBtn.click();
      } else if (e.code === "ArrowRight") {
        nextBtn.click();
      } else if (e.key === "r" || e.key === "R") {
        resetBtn.click();
      }
    });

    // ABOUT PANEL
    function openAbout() {
      aboutOverlay.classList.add("visible");
    }

    function closeAbout() {
      aboutOverlay.classList.remove("visible");
    }

    aboutBtn.addEventListener("click", openAbout);
    aboutCloseBtn.addEventListener("click", closeAbout);
    aboutOverlay.addEventListener("click", (e) => {
      if (e.target === aboutOverlay) closeAbout();
    });

    // MAIN PAGE LINK (placeholder)
    function goToMainPage() {
      window.location.href = "../../index.html";
    }

    mainPageBtn.addEventListener("click", goToMainPage);

    // SOUND TOGGLE
    soundBtn.addEventListener("click", () => {
      soundEnabled = !soundEnabled;
      updateSoundIcon();
      if (!soundEnabled && "speechSynthesis" in window) {
        window.speechSynthesis.cancel();
      }
    });

    // SCREEN TOGGLE
    screenBtn.addEventListener("click", async () => {
      wakeLockEnabled = !wakeLockEnabled;
      updateScreenIcon();
      if (wakeLockEnabled) {
        requestWakeLock();
      } else {
        await releaseWakeLock();
      }
    });

    // Initial state: description hidden
    exerciseDescriptionEl.classList.remove("visible");
    exerciseNameContainer.classList.remove("expanded");

    // Initial paint
    updateSoundIcon();
    updateScreenIcon();
    updateUI();

    // Try to acquire wake lock on load (may require gesture in some browsers)
    window.addEventListener("load", () => {
      if (wakeLockEnabled) {
        requestWakeLock();
      }
    });
  </script>
</body>
</html>
