<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üçé 25:00 ¬∑ Focus</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<meta name="theme-color" content="#0b0b12">
<style>
  :root{
    --bg1:#0b0b12; --bg2:#10101a; --glass:rgba(255,255,255,0.08);
    --text:#e7e9ee; --muted:#a7acbb; --accent:#7c5cff; --accent2:#00e0ff; --good:#41e2a8; --warn:#f8b84a; --bad:#ff6b6b;
    --shadow: 0 18px 50px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.06);
    --radius: 22px;
  }
  body.theme-light{
    --bg1:#f6f7fb; --bg2:#e9edf5; --glass: rgba(0,0,0,.06);
    --text:#0b0b12; --muted:#5f6678; --accent:#6b57ff; --accent2:#00bcd4;
    --shadow: 0 10px 30px rgba(0,0,0,.12), inset 0 0 0 1px rgba(0,0,0,.06);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--text); background:
      radial-gradient(1200px 1200px at 80% 10%, #151530 0%, transparent 60%),
      radial-gradient(1200px 1200px at 10% 90%, #101a22 0%, transparent 60%),
      linear-gradient(120deg, var(--bg1), var(--bg2));
    overflow-x:hidden;
    transition: background .3s ease, color .2s ease;
    -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
  }
  body.theme-light{ background:
      radial-gradient(1200px 1200px at 80% 10%, #ffffff 0%, transparent 60%),
      radial-gradient(1200px 1200px at 10% 90%, #f7fbff 0%, transparent 60%),
      linear-gradient(120deg, var(--bg1), var(--bg2)); }

  /* Environment animation states */
  body.state-idle .bg-anim::before,
  body.state-idle .bg-anim::after{ animation-duration: 22s }
  body.state-focus-running .bg-anim::before,
  body.state-focus-running .bg-anim::after{ animation-duration: 12s; filter: blur(42px) saturate(1.35); }
  body.state-break-running .bg-anim::before,
  body.state-break-running .bg-anim::after{ animation-duration: 16s; filter: blur(70px) saturate(1.6) hue-rotate(28deg); }
  .bg-anim::before, .bg-anim::after{
    content:""; position:fixed; inset:-20% -20% auto auto; width:70vw; height:70vw; z-index:-1;
    background:radial-gradient(circle at 30% 30%, rgba(124,92,255,.66), transparent 60%),
               radial-gradient(circle at 70% 70%, rgba(0,224,255,.45), transparent 60%);
    filter: blur(60px); opacity:.55; mix-blend:screen; border-radius:50%;
    animation: float1 18s linear infinite alternate;
    transition: filter .5s ease, animation-duration .5s ease, opacity .3s ease;
  }
  body.theme-light .bg-anim::before, body.theme-light .bg-anim::after{ opacity:.35 }
  .bg-anim::after{ left:-10%; top:40%; width:55vw; height:55vw; animation: float2 22s linear infinite alternate; }
  @keyframes float1{ from{transform:translate3d(0,0,0) rotate(0deg)} to{transform:translate3d(-6vw,4vh,0) rotate(25deg)} }
  @keyframes float2{ from{transform:translate3d(0,0,0) scale(1)} to{transform:translate3d(6vw,-4vh,0) scale(1.1)} }

  /* Header (mobile-friendly) */
  header{
    display:flex; align-items:center; justify-content:space-between; gap:14px; padding:14px clamp(12px,4vw,40px);
    position:sticky; top:0; backdrop-filter:saturate(1.2) blur(10px);
    background:linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.08));
    z-index:10; border-bottom:1px solid rgba(255,255,255,.06);
    flex-wrap:wrap;
  }
  body.theme-light header{
    background:linear-gradient(180deg, rgba(255,255,255,.8), rgba(255,255,255,.6));
    border-bottom:1px solid rgba(0,0,0,.06);
  }
  .brand{ display:flex; align-items:center; gap:10px; min-width:240px; flex:1 1 auto }
  .logo{
    width:36px; height:36px; border-radius:12px; background:
      conic-gradient(from 140deg, var(--accent), var(--accent2));
    box-shadow:0 10px 24px rgba(124,92,255,.45), inset 0 0 0 1px rgba(255,255,255,.18);
    position:relative; flex:0 0 auto;
  }
  .logo::after{
    content:""; position:absolute; inset:4px; border-radius:9px; background:rgba(0,0,0,.2);
    box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);
  }
  .title{ font-weight:800; letter-spacing:.3px; line-height:1.1 }
  .brand .hint{ display:block }
  @media (max-width: 430px){
    .brand .hint{ display:none }
  }
  .actions{ display:flex; align-items:center; gap:8px; flex:0 0 auto }
  @media (max-width: 560px){
    .actions{ width:100%; justify-content:space-between; padding-top:6px }
  }
  .streak{
    padding:12px 15px; border-radius:999px; background:var(--glass);
    box-shadow: var(--shadow); color:var(--good); font-weight:800; font-variant-numeric:tabular-nums;
    font-size:14px;
  }

  /* Buttons */
  .btn{
    display:inline-flex; align-items:center; justify-content:center;
    appearance:none; border:none; color:var(--text); background:var(--glass);
    padding:13px 18px; border-radius:16px; cursor:pointer; font-weight:800;
    box-shadow: 0 12px 28px rgba(0,0,0,.4), inset 0 0 0 1px rgba(255,255,255,.12);
    transition: transform .08s ease, filter .18s ease, background .18s ease, box-shadow .18s ease;
    position:relative; overflow:hidden; isolation:isolate;
    min-height:44px; -webkit-tap-highlight-color: transparent;
  }
  .btn:disabled{ opacity:.6; cursor:not-allowed }
  body.theme-light .btn{ box-shadow: 0 8px 20px rgba(0,0,0,.12), inset 0 0 0 1px rgba(0,0,0,.06) }
  .btn:hover{
    transform: translateY(-4px) scale(1.03);
    filter: brightness(1.2) contrast(1.1) drop-shadow(0 14px 30px rgba(124,92,255,.45));
    box-shadow: 0 18px 48px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.16);
  }
  .btn:active{ transform: translateY(0px) scale(.99) }
  .btn.ghost{ background:transparent; box-shadow: inset 0 0 0 1px rgba(255,255,255,.18) }
  body.theme-light .btn.ghost{ box-shadow: inset 0 0 0 1px rgba(0,0,0,.18) }
  .btn.primary{ background: linear-gradient(135deg, var(--accent), var(--accent2)); color:#0b0b12; }
  .btn.warn{ background: linear-gradient(135deg, #f8b84a, #ff9f1a); color:#0b0b12; }
  .btn.bad{ background: linear-gradient(135deg, #ff6b6b, #ff3b3b); color:#0b0b12; }

  /* Animated CTA pulse for start */
  .btn.cta{ animation: breathe 1.6s ease-in-out infinite; }
  body.state-focus-running .btn.cta{ animation: none }
  @keyframes breathe{
    0%,100%{ transform: translateY(0) scale(1); }
    50%{ transform: translateY(-5px) scale(1.05); box-shadow: 0 22px 60px rgba(124,92,255,.5); }
  }

  /* Snake border on hover */
  .btn::before{
    pointer-events:none;
    content:""; position:absolute; inset:0; border-radius:inherit; padding:2px;
    background: conic-gradient(from 0deg, #fff, rgba(255,255,255,.2), #fff);
    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask-composite: xor; mask-composite: exclude;
    opacity:0; transition:opacity .2s ease;
  }
  body.theme-light .btn::before{ background: conic-gradient(from 0deg, rgba(0,0,0,.9), rgba(0,0,0,.2), rgba(0,0,0,.9)) }
  .btn:hover::before{ opacity:1; animation: spin 1.2s linear infinite }
  .btn.cta:hover::before{ animation-duration: .65s }
  @keyframes spin{ to{ transform: rotate(360deg) } }

  /* Ripple on click */
  .btn .rip{ position:absolute; border-radius:50%; transform:scale(0); opacity:.7; background:#fff; pointer-events:none; animation:rip 700ms ease-out; mix-blend:overlay; }
  @keyframes rip{ to{ transform:scale(10); opacity:0 } }

  .toggle{ display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; background:var(--glass); box-shadow:var(--shadow) }
  .toggle input{ accent-color:var(--accent) }

  main{ display:grid; place-items:center; padding: 0 16px 16px }
  .grid{
    width:min(1020px, 92vw); display:grid; grid-template-columns: 1fr; gap:20px;
  }
  @media (min-width: 980px){
    .grid{ grid-template-columns: 1.1fr .9fr; }
  }
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
    backdrop-filter: blur(10px); border-radius: var(--radius); padding: 22px;
    box-shadow: var(--shadow); position:relative; overflow:hidden;
  }
  body.theme-light .card{ background: linear-gradient(180deg, rgba(0,0,0,.04), rgba(0,0,0,.02)) }
  .card h2{ margin:0 0 10px 2px; font-size:14px; color:var(--muted); font-weight:800; letter-spacing:.15em; text-transform:uppercase }
  .timer-wrap{ display:grid; place-items:center; padding:10px 0 20px }
  .ring{
    width: min(500px, 100%); aspect-ratio:1/1; position:relative;
    display:grid; place-items:center; margin:0 auto;
  }
  @media (min-width: 540px){
    .ring{ width:min(480px, 62vw); }
  }
  .ring svg{ width:100%; height:100%; transform:rotate(-90deg); display:block; }
  @media (max-width:560px){.ring{ width: calc(100% - 4px); }}
  .ring .shadow{
    position:absolute; inset:0; border-radius:50%; filter:blur(16px); opacity:.7;
    background:radial-gradient(closest-side, rgba(124,92,255,.25), transparent 70%);
    pointer-events:none;
  }
  .time{
    position:absolute; display:flex; flex-direction:column; align-items:center; gap:8px; text-align:center; width:92%;
  }
  .time .mmss{ font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, monospace; font-size: clamp(44px, 10vw, 82px); font-weight:900; letter-spacing:1px; text-shadow: 0 6px 30px rgba(0,0,0,.5) }
  body.theme-light .time .mmss{ text-shadow: none }
  .eta{ font-size:12px; color:var(--muted) }
  .pill{ padding:6px 10px; border-radius:999px; background: rgba(255,255,255,.1); box-shadow: inset 0 0 0 1px rgba(255,255,255,.14); color:var(--muted); font-weight:900; letter-spacing:.12em; text-transform:uppercase; font-size:12px }
  body.theme-light .pill{ background: rgba(0,0,0,.06); box-shadow: inset 0 0 0 1px rgba(0,0,0,.08) }
  .controls{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-top:12px }
  .modes{ display:flex; gap:10px; justify-content:center; margin:14px 0 0 }
  .modes .btn{ padding:10px 12px }
  .controls .btn{ min-width:120px }
  .controls .btn.small{ min-width:auto; padding:10px 12px; font-weight:800 }
  .controls .btn.cta{ font-size:17px; padding:15px 24px; border-radius:18px }
  @media (max-width: 560px){
    .controls{ flex-direction:column }
    .controls .btn{ width:100% }
    .modes{ flex-wrap:wrap }
  }
  .meta{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:18px; align-items:start }
  @media (max-width:560px){ .meta{ grid-template-columns: 1fr } }
  .meta .kpi{ background:var(--glass); border-radius:14px; padding:14px; text-align:center; box-shadow:var(--shadow) }
  .kpi b{ font-variant-numeric: tabular-nums; font-size:22px; display:block; margin:2px 0 }
  .kpi span{ color:var(--muted); font-size:12px; letter-spacing:.08em; text-transform:uppercase; font-weight:800 }
  .meta .actions-col{ display:flex; gap:10px; justify-content:center }
  .btn.sm{ padding:8px 12px; border-radius:12px; font-weight:800; }

  .quote{ font-size: clamp(16px, 2.2vw, 20px); line-height:1.35; color:#f0f3ff; }
  body.theme-light .quote{ color:#1a1d2a }
  .quote small{ display:block; color:var(--muted); margin-top:6px }
  .quote-wrap{ display:flex; align-items:flex-start; gap:14px }
  .quote-mark{ font-size:38px; line-height:1; color:var(--accent2); opacity:.9; filter:drop-shadow(0 8px 14px rgba(0,224,255,.3)) }
  .roadmap{ display:grid; gap:10px }
  .step{ display:flex; align-items:center; gap:12px; background:var(--glass); border-radius:14px; padding:12px 14px; box-shadow:var(--shadow); transition: transform .2s ease, box-shadow .2s ease, background .2s ease }
  .dot{ width:10px; height:10px; border-radius:50%; background:var(--muted); box-shadow:0 0 0 0 rgba(124,92,255,.0) }
  .step.active{ transform: scale(1.04); background: linear-gradient(180deg, rgba(124,92,255,.24), rgba(124,92,255,.10)); box-shadow: 0 18px 48px rgba(124,92,255,.28), inset 0 0 0 1px rgba(255,255,255,.1) }
  .step.active .dot{ background:var(--accent); box-shadow: 0 0 0 8px rgba(124,92,255,.25), 0 0 30px rgba(124,92,255,.6) }
  .step.done{ opacity:.9 }
  .step.done .dot{ background:var(--good) }
  .step b{ font-variant-numeric:tabular-nums }
  .step span{ color:var(--muted) }

  .settings{ display:grid; gap:12px }
  .field{ display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; background:var(--glass); padding:12px 14px; border-radius:14px; box-shadow:var(--shadow) }
  .field input[type="number"]{ width:90px; background:transparent; border:none; color:var(--text); font-weight:800; padding:8px 10px; border-radius:10px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.14) }
  body.theme-light .field input[type="number"]{ box-shadow: inset 0 0 0 1px rgba(0,0,0,.12) }
  .hint{ color:var(--muted); font-size:12px }
  .kbd{ font-family:"JetBrains Mono", monospace; background:rgba(255,255,255,.1); padding:2px 6px; border-radius:6px; font-size:12px }
  body.theme-light .kbd{ background:rgba(0,0,0,.06) }

  /* slide panel */
  .panel{
    position: fixed; right:18px; bottom:18px; width:min(620px, 96vw); max-height:82vh; overflow:auto;
    transform: translateY(12px); opacity:0; visibility:hidden; transition:.25s ease;
  }
  .panel.open{ transform:none; opacity:1; visibility:visible }
  .panel .card{ padding-bottom:18px }
  .panel-close{ position:sticky; top:6px; display:flex; justify-content:flex-end; }
  .panel-close .btn{ padding:8px 10px }

  footer{ padding:10px 20px; text-align:center; color:var(--muted); font-size:12px }
  a{ color:#c8d2ff; text-decoration:none }
  body.theme-light a{ color:#5b47ff }
  a:hover{ text-decoration:underline }
  a.btn, a.btn:hover { text-decoration: none; }
</style>
</head>
<body class="state-idle">
<div class="bg-anim"></div>
<header>
  <div class="brand">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <div class="title">Pomodoro+ <span style="opacity:.6; font-weight:600">Focus & Flow</span></div>
      <div class="hint">Enhanced Timer ¬∑ Action-Packed ¬∑ Time Locksmith</div>
    </div>
  </div>
  <div class="actions">
    <div class="streak" id="streakBadge">üî• Streak: 0</div>
    <button class="btn ghost" id="toggleTheme" title="Toggle Theme (T)"><span>üåó Theme</span></button>
    <button class="btn" id="openSettings" title="Settings (S)">‚öôÔ∏è Config</button>
    <a class="btn" id="btnHome" href="../../index.html" title="Main Page (H)" aria-label="Main Page">üè† Main</a>
  </div>
</header>

<main>
  <div class="grid">
    <section class="card">
      <h2>Session</h2>
      <div class="timer-wrap">
        <div class="ring">
          <svg viewBox="0 0 120 120" role="img" aria-label="Timer progress ring">
            <defs>
              <linearGradient id="g">
                <stop offset="0%" stop-color="#7c5cff" />
                <stop offset="100%" stop-color="#00e0ff" />
              </linearGradient>
            </defs>
            <circle cx="60" cy="60" r="52" fill="none" stroke="rgba(255,255,255,.08)" stroke-width="10" />
            <circle id="progress" cx="60" cy="60" r="52" fill="none" stroke="url(#g)" stroke-width="10" stroke-linecap="round" stroke-dasharray="327" stroke-dashoffset="327"/>
          </svg>
          <div class="shadow"></div>
          <div class="time">
            <div class="pill" id="modePill">Focus</div>
            <div class="mmss" id="mmss">25:00</div>
            <div class="eta" id="etaPhase">Phase ends ~ <b>--:--</b></div>
            <div class="hint" id="subtext">Deep work in progress‚Ä¶</div>
            <div class="controls">
              <button class="btn primary cta" id="btnToggle" role="button" aria-pressed="false">‚ñ∂ Start</button>
              <button class="btn ghost small" id="btnReset">‚ü≤ Reset</button>
              <button class="btn warn small" id="btnSkip">‚§º Skip</button>
            </div>
          </div>
        </div>
      </div>
      <h2>Today Stats</h2>
      <div class="meta">
        
        <div class="kpi"><span>Focus Time</span><b id="kpiToday">0m 00s</b></div>
        <div class="kpi"><span>Break Time</span><b id="kpiBreak">0m 00s</b></div>

      </div>
    </section>

    <section class="card">
      <!-- Motivational quote (uses existing CSS + JS) -->
      <div class="quote-wrap" id="motivation" style="margin-top:14px">
        <div class="quote-mark">‚Äú</div>
        <div class="quote">
          <span id="quoteText">There is no such thing as no work to do.</span>
          <small id="quoteAuthor">‚Äî Unknown</small>
        </div>
      </div>
      <h2>Roadmap</h2>
      <div class="eta" id="etaTotals">Session totals ‚Äî Focus <b>--</b> ¬∑ Break <b>--</b></div>
      <div class="eta" id="etaCycle">Cycle ends ~ <b>--:--</b></div>
      <div style="display:flex; justify-content:center; gap:8px; margin:4px 0 8px;">
        <button class="btn ghost sm" id="btnAddBlock">Ôºã Block</button>
        <button class="btn ghost sm" id="btnRemoveBlock">‚àí Block</button>
        <button class="btn ghost sm" id="btnResetStats">üßπ Reset Stats</button>
      </div>
      <div class="roadmap" id="roadmap"></div>
    </section>
  </div>
</main>

<div class="panel" id="panel" aria-hidden="true">
  <section class="card">
    <div class="panel-close"><button class="btn ghost" id="closePanel">‚úñ Close</button></div>
    <h2>Settings</h2>
    <div class="settings">
      <div class="field">
        <div>
          <b>Focus minutes</b><div class="hint">Work session length</div>
        </div>
        <input type="number" id="inpFocus" min="5" max="120" step="1" value="25">
      </div>
      <div class="field">
        <div>
          <b>Short break</b><div class="hint">Quick reset time</div>
        </div>
        <input type="number" id="inpShort" min="3" max="45" step="1" value="5">
      </div>
      <div class="field">
        <div>
          <b>Long break</b><div class="hint">Full recharge time</div>
        </div>
        <input type="number" id="inpLong" min="10" max="90" step="1" value="15">
      </div>
      <div class="field">
        <div>
          <b>Blocks (Focus ‚Üí Break)</b><div class="hint">Min 2 blocks. Default 3</div>
        </div>
        <input type="number" id="inpCycles" min="2" max="10" step="1" value="3">
      </div>
      <div class="field">
        <div>
          <b>Sound</b><div class="hint">Chimes + Voice</div>
        </div>
        <label class="toggle"><input type="checkbox" id="chkSound" checked/> <span>Enable</span></label>
      </div>
      <div class="field">
        <div>
          <b>Desktop notifications</b><div class="hint">When minimized</div>
        </div>
        <button class="btn" id="btnNotify">Grant permission</button>
      </div>
      <div class="field" style="grid-template-columns:1fr; gap:8px">
        <div><b>Presets</b><div class="hint">Quick science-inspired setups</div></div>
        <div style="display:flex; gap:8px; flex-wrap:wrap">
          <button class="btn ghost small preset" data-f="25" data-s="5" data-l="15">Classic 25/5/15</button>
          <button class="btn ghost small preset" data-f="50" data-s="10" data-l="20">Flow 50/10/20</button>
          <button class="btn ghost small preset" data-f="90" data-s="20" data-l="30">Ultradian 90/20/30</button>
          <button class="btn ghost small preset" data-f="45" data-s="8" data-l="20">Balanced 45/8/20</button>
        </div>
        <div class="hint">You can tweak after applying a preset.</div>
      </div>
      <div class="hint">Shortcuts: <span class="kbd">Space</span> Start/Pause ¬∑ <span class="kbd">R</span> Reset ¬∑ <span class="kbd">N</span> Skip ¬∑ <span class="kbd">T</span> Theme ¬∑ <span class="kbd">S</span> Settings ¬∑ <span class="kbd">Esc</span> Close ¬∑ <span class="kbd">H</span> Main page</div>
    </div>
  </section>
</div>

<footer>Built with ‚ù§Ô∏è by Gerardo Sacarelo V.</footer>

<script>
(() => {
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));

  const el = {
    mmss: $('#mmss'),
    sub: $('#subtext'),
    progress: $('#progress'),
    modePill: $('#modePill'),
    btnToggle: $('#btnToggle'),
    btnReset: $('#btnReset'),
    btnSkip: $('#btnSkip'),
    btnResetStats: $('#btnResetStats'),
    kpiToday: $('#kpiToday'),
    kpiBreak: $('#kpiBreak'),
    roadmap: $('#roadmap'),
    panel: $('#panel'),
    openSettings: $('#openSettings'),
    closePanel: $('#closePanel'),
    inpFocus: $('#inpFocus'),
    inpShort: $('#inpShort'),
    inpLong: $('#inpLong'),
    inpCycles: $('#inpCycles'),
    chkSound: $('#chkSound'),
    btnNotify: $('#btnNotify'),
    streakBadge: $('#streakBadge'),
    toggleTheme: $('#toggleTheme'),
    etaPhase: $('#etaPhase b'),
    etaCycle: $('#etaCycle b'),
    etaTotals: $('#etaTotals'),
    btnAddBlock: $('#btnAddBlock'),
    btnRemoveBlock: $('#btnRemoveBlock'),
  };

  const QUOTES = [
    ["Small, consistent sprints beat rare marathons.", "Unknown"],
    ["You don‚Äôt need more time. You need more focus.", "S.J. Scott"],
    ["The secret of getting ahead is getting started.", "Mark Twain"],
    ["Fall in love with the process, and the results will follow.", "Brad Stulberg"],
    ["Focus is a muscle‚Äîtrain it daily.", "Unknown"],
    ["Move slow, finish fast.", "Unknown"],
    ["One hour of deep work can outrun a day of busy work.", "Cal Newport"],
    ["Discipline is choosing what you want most over what you want now.", "Abraham Lincoln"],
    ["You have power over your mind, not over outside events.", "Marcus Aurelius"],
    ["It is not that we have a short time to live, but that we waste a lot of it.", "Seneca"],
    ["What gets measured gets managed.", "Peter Drucker"],
    ["The successful warrior is the average man, with laser-like focus.", "Bruce Lee"],
    ["Very successful people say no to almost everything.", "Warren Buffett"],
    ["Habits are the compound interest of self-improvement.", "James Clear"],
    ["If you don‚Äôt prioritize your life, someone else will.", "Greg McKeown"],
    ["The sun‚Äôs rays do not burn until brought to a focus.", "Alexander Graham Bell"],
    ["Work expands to fill the time available for its completion.", "C. Northcote Parkinson"],
    ["The main thing is to keep the main thing the main thing.", "Stephen R. Covey"],
    ["He who has a why to live can bear almost any how.", "Friedrich Nietzsche"],
    ["Until you make the unconscious conscious, it will direct your life and you will call it fate.", "Carl Jung"],
    ["Simplicity is the ultimate sophistication.", "Leonardo da Vinci"],
    ["Clarity about what matters provides clarity about what does not.", "Greg McKeown"],
    ["If it‚Äôs not on your calendar, it‚Äôs not real.", "Michael Hyatt"],
    ["The ability to simplify means to eliminate the unnecessary so that the necessary may speak.", "Hans Hofmann"],
    ["It‚Äôs not the daily increase but daily decrease. Hack away at the unessential.", "Bruce Lee"],
    ["Focus is about saying no.", "Steve Jobs"],
    ["The successful person has the habit of doing the things failures don‚Äôt like to do.", "Albert E.N. Gray"],
    ["Time is what we want most, but what we use worst.", "William Penn"],
    ["Shallow work stops when you‚Äôre tired. Deep work starts then.", "Cal Newport"],
    ["Don‚Äôt mistake motion for progress.", "Alfred A. Montapert"],
    ["Beware the barrenness of a busy life.", "Socrates"],
    ["Discipline equals freedom.", "Jocko Willink"],
    ["Confidence is not gifted, you earn it.", "Unknown"],
    ["Climb the mountain.","Unknown"]
  ];


  // ---------- State ----------
  const state = {
    plan: [],       // [{type,label}...]
    index: 0,       // current plan index
    durations: {focus:25*60, short:5*60, long:15*60},
    running: false,
    remaining: 25*60,
    endsAt: null,
    lastTickMs: null,
    lastCountdownSpoken: null,
    tickHandle: null,
    todayKey: new Date().toISOString().slice(0,10),
  };

  // ---------- Persistence ----------
  function getStats(){
    const all = JSON.parse(localStorage.getItem('pomoplus:stats')||'{}');
    const d = all[state.todayKey] || {focusSec:0, breakSec:0, idleSec:0, sessions:0};
    all[state.todayKey] = d;
    return {all, d};
  }
  function setStats(all){ localStorage.setItem('pomoplus:stats', JSON.stringify(all)); }
  function saveSettings(){
    const s = {
      focus: el.inpFocus.valueAsNumber || 25,
      short: el.inpShort.valueAsNumber || 5,
      long:  el.inpLong.valueAsNumber  || 15,
      cycles: el.inpCycles.valueAsNumber || 3,
      sound: !!el.chkSound.checked,
    };
    localStorage.setItem('pomoplus:settings', JSON.stringify(s));
  }
  function loadSettings(){
    try{
      const s = JSON.parse(localStorage.getItem('pomoplus:settings')||'{}');
      if(s.focus) el.inpFocus.value = s.focus;
      if(s.short) el.inpShort.value = s.short;
      if(s.long)  el.inpLong.value = s.long;
      el.inpCycles.value = Math.max(2, s.cycles || 3);
      if(typeof s.sound === 'boolean') el.chkSound.checked = s.sound;
      const theme = localStorage.getItem('pomoplus:theme')||'dark';
      document.body.classList.toggle('theme-light', theme==='light');
    }catch(e){ console.warn('settings load failed', e); }
  }

  // ---------- Helpers ----------
  function fmt(sec){
    const m = Math.floor(sec/60).toString().padStart(2,'0');
    const s = Math.floor(sec%60).toString().padStart(2,'0');
    return `${m}:${s}`;
  }
  function fmtMinSecTotal(totalSec){
    const m = Math.floor(totalSec/60);
    const s = Math.floor(totalSec%60).toString().padStart(2,'0');
    return `${m}m ${s}s`;
  }
  function fmtMinTotal(totalSec){
    const m = Math.floor(totalSec/60);
    return `${m}m`;
  }
  function updateTitle(){
    const apple = currentType()==='focus' ? 'üçé' : 'üçè';
    document.title = `${apple} ${fmt(state.remaining)} ¬∑ ${el.modePill.textContent}`;
  }
  function ringProgress(frac){
    const C = 2 * Math.PI * 52;
    const off = C - C * Math.max(0, Math.min(1, frac));
    el.progress.style.strokeDashoffset = off.toFixed(1);
  }
  function timePlus(ms){
    const d = new Date(Date.now() + ms);
    const hh = d.getHours().toString().padStart(2,'0');
    const mm = d.getMinutes().toString().padStart(2,'0');
    return `${hh}:${mm}`;
  }
  function setEtas(){
    el.etaPhase.textContent = timePlus(state.remaining*1000);
    // cycle ETA from current index to the end
    let secs = state.remaining;
    for(let i=state.index+1; i<state.plan.length; i++){
      secs += durationFor(state.plan[i].type);
    }
    el.etaCycle.textContent = timePlus(secs*1000);
    setSessionTotals();
  }
  function durationFor(t){ return state.durations[t]; }
  function currentType(){ return state.plan[state.index]?.type || 'focus'; }
  function computeSessionTotals(){
    let f = 0, b = 0;
    for(const step of state.plan){
      const d = durationFor(step.type);
      if(step.type==='focus') f += d; else b += d;
    }
    return {f, b};
  }
  function setSessionTotals(){
    const {f,b} = computeSessionTotals();
    el.etaTotals.innerHTML = `Session = <b>${fmtMinTotal(f+b)}</b> ‚Äî Focus <b>${fmtMinSecTotal(f)}</b> + Break <b>${fmtMinSecTotal(b)}</b>`;
  }

  // ---------- Plan & Roadmap ----------
  function buildPlan(){
    const N = Math.max(2, (el.inpCycles.valueAsNumber||3));
    state.durations.focus = (el.inpFocus.valueAsNumber||25)*60;
    state.durations.short = (el.inpShort.valueAsNumber||5)*60;
    state.durations.long  = (el.inpLong.valueAsNumber||15)*60;
    const plan = [];
    for(let i=1;i<=N;i++){
      plan.push({type:'focus', label:`Focus #${i}`});
      if(i<N) plan.push({type:'short', label:`Break #${i}`});
    }
    plan.push({type:'long', label:`Long Break`});
    state.plan = plan;
    renderRoadmap();
    setSessionTotals();
  }
  function renderRoadmap(){
    const frag = document.createDocumentFragment();
    state.plan.forEach(step=>{
      const node = document.createElement('div');
      node.className = 'step';
      node.innerHTML = `<div class="dot"></div><b>${step.label}</b> <span>${Math.round(durationFor(step.type)/60)} min</span>`;
      frag.appendChild(node);
    });
    el.roadmap.replaceChildren(frag);
    highlightRoadmap();
  }
  function highlightRoadmap(){
    const steps = $$('#roadmap .step');
    steps.forEach((node,i)=>{
      node.classList.toggle('active', i===state.index);
      node.classList.toggle('done', i<state.index);
    });
  }

  // ---------- Stats ----------
  function updateKpis(){
    const {d} = getStats();
    el.kpiToday.textContent = fmtMinSecTotal(d.focusSec||0);
    el.kpiBreak.textContent = fmtMinSecTotal((d.breakSec||0) + (d.idleSec||0));
  }
  function addFocus(sec){ const {all,d}=getStats(); d.focusSec=(d.focusSec||0)+sec; setStats(all); }
  function addBreak(sec){ const {all,d}=getStats(); d.breakSec=(d.breakSec||0)+sec; setStats(all); }
  function addIdle(sec){ const {all,d}=getStats(); d.idleSec=(d.idleSec||0)+sec; setStats(all); }
  function bumpSession(){ const {all,d}=getStats(); d.sessions=(d.sessions||0)+1; setStats(all); updateStreak(); }
  function resetTodayStats(){ const {all}=getStats(); all[state.todayKey]={focusSec:0,breakSec:0,idleSec:0,sessions:0}; setStats(all); updateKpis(); updateStreak(); }
  function updateStreak(){
    // Show completed sessions TODAY (per your request)
    const {d} = getStats();
    el.streakBadge.textContent = `üî• Streak: ${d.sessions||0}`;
  }

  // ---------- Audio/TTS ----------
  let audioCtx=null;
  function tone(freq=880, ms=160){
    if(!el.chkSound.checked) return;
    try{
      audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
      const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
      o.connect(g); g.connect(audioCtx.destination);
      o.type='sine'; o.frequency.value=freq;
      g.gain.value=.001; g.gain.exponentialRampToValueAtTime(.25, audioCtx.currentTime+.02);
      g.gain.exponentialRampToValueAtTime(.001, audioCtx.currentTime + ms/1000);
      o.start(); o.stop(audioCtx.currentTime + ms/1000 + .02);
    }catch(e){}
  }
  function announceStart(){
    try{
      if(el.chkSound.checked){
        const mode = currentType();
        if(mode==='focus'){ tone(740,140); setTimeout(()=>tone(1100,180),120); }
        else { tone(520,140); setTimeout(()=>tone(780,180),120); }
      }
      if('speechSynthesis' in window){
        const u = new SpeechSynthesisUtterance(currentType()==='focus' ?
          ["Session start! Go!","Let's rock!","Deep work: engage!"][Math.floor(Math.random()*3)] :
          ["Break time!","Resting time!","Reset: breathe."][Math.floor(Math.random()*3)]
        );
        u.rate=1.0; u.pitch=1.0; u.volume = el.chkSound.checked ? 1 : 0;
        speechSynthesis.cancel(); speechSynthesis.speak(u);
      }
    }catch(e){}
  }

  // ---------- Phase control ----------
  function setPhase(idx, {announce=false}={}){
    state.index = Math.max(0, Math.min(idx, state.plan.length-1));
    const step = state.plan[state.index];
    state.remaining = durationFor(step.type);
    state.endsAt = null;
    state.lastTickMs = null;
    state.lastCountdownSpoken = null;
    el.modePill.textContent = step.label.includes('Break') ? (step.label) : 'Focus';
    el.sub.textContent = step.type==='focus' ? 'Deep work in progress‚Ä¶' : (step.type==='short' ? 'Breathe. Stretch. Sip water.' : 'Step away. Full reset.');
    el.mmss.textContent = fmt(state.remaining);
    ringProgress(0);
    setEtas();
    highlightRoadmap();
    const apple = step.type==='focus' ? 'üçé' : 'üçè';
    document.title = `${apple} ${fmt(state.remaining)} ¬∑ ${el.modePill.textContent}`;
    if(announce) announceStart();
  }
  function moveNext({announce=false}={}){
    if(currentType()==='long'){
      // end of cycle: count session, stop & reset to start
      bumpSession();
      stop();
      setPhase(0,{announce:false});
      return;
    }
    setPhase(state.index+1,{announce});
    if(state.running){
      // seamless continue
      state.endsAt = Date.now() + state.remaining*1000;
      state.lastTickMs = Date.now();
    }
  }

  // ---------- Timer ----------
  function tick(){
    try{
      if(!state.running) return;
      const now = Date.now();
      // accumulate real seconds since last tick
      if(state.lastTickMs!=null){
        const deltaSec = Math.max(0, Math.floor((now - state.lastTickMs)/1000));
        if(deltaSec>0){
          if(currentType()==='focus') addFocus(deltaSec); else addBreak(deltaSec);
          state.lastTickMs += deltaSec*1000;
          updateKpis();
        }
      }else{
        state.lastTickMs = now;
      }
      if(state.endsAt==null) state.endsAt = now + state.remaining*1000;
      const rem = Math.max(0, Math.ceil((state.endsAt - now)/1000));
      if(rem !== state.remaining){
        state.remaining = rem;
        el.mmss.textContent = fmt(rem);
        ringProgress(1 - (state.remaining / durationFor(currentType())));
        setEtas();
        updateTitle();
        // 3..2..1
        if(rem<=3 && rem>=1 && state.lastCountdownSpoken !== rem){
          try{
            if('speechSynthesis' in window){
              const u = new SpeechSynthesisUtterance(String(rem));
              u.volume = el.chkSound.checked ? 1 : 0;
              speechSynthesis.cancel(); speechSynthesis.speak(u);
            }
          }catch(e){}
          state.lastCountdownSpoken = rem;
        }
      }
      if(rem<=0){
        // phase complete -> next
        moveNext({announce:true});
      }
    }catch(err){
      console.error('tick error', err);
      stop(); // fail-safe
    }
  }
  function start(){
    if(state.running) return;
    state.running = true;
    el.btnToggle.textContent = '‚è∏ Pause';
    el.btnToggle.classList.remove('cta');
    el.btnToggle.setAttribute('aria-pressed','true');
    state.endsAt = Date.now() + state.remaining*1000;
    state.lastTickMs = Date.now();
    if(state.tickHandle) clearInterval(state.tickHandle);
    state.tickHandle = setInterval(tick, 250);
    document.body.classList.remove('state-idle','state-break-running','state-focus-running');
    document.body.classList.add(currentType()==='focus' ? 'state-focus-running' : 'state-break-running');
    announceStart();
  }
  function stop(){
    state.running = false;
    el.btnToggle.textContent = '‚ñ∂ Start';
    el.btnToggle.classList.add('cta');
    el.btnToggle.setAttribute('aria-pressed','false');
    if(state.tickHandle){ clearInterval(state.tickHandle); state.tickHandle=null; }
    state.endsAt = null;
    document.body.classList.remove('state-focus-running','state-break-running');
    document.body.classList.add('state-idle');
  }
  function resetSession(){
    stop();
    buildPlan();
    setPhase(0,{announce:false});
  }
  document.addEventListener('visibilitychange', () => {
    if (!document.hidden && state.running) {
      // instantly sync to wall-clock on return
      tick();
    }
  });


  // ---------- UI Events ----------
  el.btnToggle.addEventListener('click', ()=> (state.running?stop():start()));
  el.btnReset.addEventListener('click', resetSession);
  el.btnSkip.addEventListener('click', ()=>{
    const wasRunning = state.running;
    if(wasRunning){
      state.lastTickMs = Date.now();
    }
    moveNext({announce:true});
    if(wasRunning){
      state.endsAt = Date.now() + state.remaining*1000;
      state.lastTickMs = Date.now();
    }
  });
  el.btnResetStats.addEventListener('click', ()=>{
    if(confirm("Reset today's Focus/Break stats?")) resetTodayStats();
  });

  // Add/Remove block buttons (affect cycles)
  el.btnAddBlock.addEventListener('click', ()=>{
    el.inpCycles.value = Math.max(2, (el.inpCycles.valueAsNumber||3)+1);
    saveSettings();
    const wasRunning = state.running; stop(); buildPlan(); setPhase(0,{announce:false}); if(wasRunning) start();
  });
  el.btnRemoveBlock.addEventListener('click', ()=>{
    el.inpCycles.value = Math.max(2, (el.inpCycles.valueAsNumber||3)-1);
    saveSettings();
    const wasRunning = state.running; stop(); buildPlan(); setPhase(0,{announce:false}); if(wasRunning) start();
  });

  // Settings panel & interactions
  function togglePanel(force){
    const open = typeof force==='boolean' ? force : !el.panel.classList.contains('open');
    el.panel.classList.toggle('open', open);
    el.panel.setAttribute('aria-hidden', open ? 'false' : 'true');
  }
  el.openSettings.addEventListener('click', ()=>togglePanel());
  el.closePanel.addEventListener('click', ()=>togglePanel(false));
  document.addEventListener('click', (e)=>{
    if(el.panel.classList.contains('open') && !el.panel.contains(e.target) && e.target!==el.openSettings){
      togglePanel(false);
    }
  });
  [el.inpFocus, el.inpShort, el.inpLong, el.inpCycles, el.chkSound].forEach(x=> x.addEventListener('input', ()=>{
    saveSettings();
    const wasRunning = state.running;
    stop();
    buildPlan();
    // keep same type where possible
    const curType = currentType();
    let idx = state.plan.findIndex(s=>s.type===curType);
    if(idx<0) idx = 0;
    setPhase(idx,{announce:false});
    if(wasRunning) start();
  }));

  // Presets
  $$('.preset').forEach(p => p.addEventListener('click', ()=>{
    el.inpFocus.value = +p.dataset.f;
    el.inpShort.value = +p.dataset.s;
    el.inpLong.value  = +p.dataset.l;
    saveSettings();
    const wasRunning = state.running;
    stop();
    buildPlan();
    setPhase(0,{announce:false});
    if(wasRunning) start();
  }));

  // Theme & shortcuts
  function toggleTheme(){
    const cur = localStorage.getItem('pomoplus:theme')||'dark';
    const next = cur==='dark' ? 'light' : 'dark';
    localStorage.setItem('pomoplus:theme', next);
    document.body.classList.toggle('theme-light', next==='light');
  }
  el.toggleTheme.addEventListener('click', toggleTheme);
  document.addEventListener('keydown', (e)=>{
    if(e.code==='Space'){ e.preventDefault(); (state.running ? stop : start)(); }
    if(e.key.toLowerCase()==='r') resetSession();
    if(e.key.toLowerCase()==='n') el.btnSkip.click();
    if(e.key.toLowerCase()==='s') togglePanel();
    if(e.key.toLowerCase()==='t') toggleTheme();
    if(e.key.toLowerCase()==='h') window.location.href='../../index.html';
    if(e.key==='Escape') togglePanel(false);
  });

  // Click ripple
  document.addEventListener('click', (e)=>{
    const b = e.target.closest?.('.btn, a.btn');
    if(!b) return;
    const r = document.createElement('span');
    const rect = b.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    r.className='rip'; r.style.width=r.style.height = size+'px';
    r.style.left = (e.clientX - rect.left - size/2)+'px';
    r.style.top  = (e.clientY - rect.top  - size/2)+'px';
    b.appendChild(r); setTimeout(()=>r.remove(), 750);
  });

  // Notifications
  el.btnNotify?.addEventListener('click', async ()=>{
    try{
      const p = await Notification.requestPermission();
      el.btnNotify.textContent = p==='granted' ? '‚úÖ Enabled' : 'Try again';
    }catch(e){}
  });

  // ---------- Init ----------
  (function init(){
    loadSettings();
    buildPlan();
    setPhase(0,{announce:false});
    updateKpis();
    updateStreak();
    // Idle accrual while not running
    setInterval(()=>{ if(!state.running) { addIdle(1); updateKpis(); setEtas();} }, 1000);
    // Quote
    const [t,a] = QUOTES[Math.floor(Math.random()*QUOTES.length)];
    const qt = document.getElementById('quoteText'); const qa = document.getElementById('quoteAuthor');
    if(qt && qa){ qt.textContent = t; qa.textContent = `‚Äî ${a}`; }
  })();
})();
</script>
</body>
</html>
